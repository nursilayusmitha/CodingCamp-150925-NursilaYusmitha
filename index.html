<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DailyDo</title>
  
  <!-- Favicon -->
  <link rel="icon" href="public/favicon.ico" type="image/x-icon">


  <!-- Tailwind + DaisyUI -->
  <link
    href="https://cdn.jsdelivr.net/npm/daisyui@2.18.0/dist/full.css"
    rel="stylesheet"
    type="text/css"
  />
  <link
    href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2/dist/tailwind.min.css"
    rel="stylesheet"
    type="text/css"
  />
  <link
    href="https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css"
    rel="stylesheet"
  />
  <style>
    /* Mengatur scroll vertikal pada mobile */
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow-x: hidden;
    }
    
    @media (max-width: 768px) {
      body, html {
        overflow-y: auto;
      }
    }

    .container {
      max-width: 100%;
    }

    .header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .site-title {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .site-title img {
      width: 32px;
      height: 32px;
      object-fit: contain;
    }

    .datetime-inline {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
    }

    .datetime-inline .day {
      min-width: 90px;
      text-align: left;
    }

    /* status badges */
    .status-badge {
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .status-overdue {
      background: rgba(220, 38, 38, 0.1);
      color: #dc2626;
      border: 1px solid rgba(220, 38, 38, 0.2);
    }

    .status-complete {
      background: rgba(34,197,94,0.1);
      color: #22c55e;
      border: 1px solid rgba(34,197,94,0.15);
    }

    .status-pending {
      background: rgba(245,158,11,0.08);
      color: #f59e0b;
      border: 1px solid rgba(245,158,11,0.12);
    }

    /* small responsive tweaks for table due column */
    .due-date-cell {
      display: flex;
      flex-direction: column;
    }

    /* make modal inputs full width on small screens */
    @media (max-width: 640px) {
      .datetime-inline {
        font-size: 14px;
      }
    }

    .header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .site-title {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .site-title img {
      width: 48px;
      height: 48px;
      object-fit: contain;
    }

    .datetime-inline {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
    }

    .table-container {
      max-height: 400px;
      overflow-y: auto;
    }

    /* Perbaikan header tabel agar tidak bergerak saat di-scroll horizontal */
    .table-container thead th {
      position: sticky;
      top: 0;
      background: #fff;
      z-index: 20;
      white-space: nowrap;
    }

    /* Style header tabel yang lebih bagus */
    .table-container thead th {
      background-color: #4f46e5;
      color: white;
      font-weight: bold;
      text-transform: uppercase;
      font-size: 0.875rem;
      padding: 0.75rem 1rem;
      border-bottom: 2px solid #e5e7eb;
    }

    .table-container tbody td {
      padding: 0.75rem 1rem;
      vertical-align: middle;
    }

    /* status badges */
    .status-badge {
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .status-overdue {
      background: rgba(220, 38, 38, 0.1);
      color: #dc2626;
      border: 1px solid rgba(220, 38, 38, 0.2);
    }

    .status-complete {
      background: rgba(34, 197, 94, 0.1);
      color: #22c55e;
      border: 1px solid rgba(34, 197, 94, 0.15);
    }

    .status-pending {
      background: rgba(245, 158, 11, 0.08);
      color: #f59e0b;
      border: 1px solid rgba(245, 158, 11, 0.12);
    }

    .due-date-cell {
      display: flex;
      flex-direction: column;
    }

    @media (max-width: 640px) {
      .datetime-inline {
        font-size: 14px;
      }
    }

    /* Header */
    .header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .site-title img {
      width: 32px;
      height: 32px;
      object-fit: contain;
    }

    .datetime-inline {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
    }

    /* Table */
    .table-container {
      max-height: 400px;
      overflow-y: auto;
    }

    /* Status badges */
    .status-badge {
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .status-overdue {
      background: rgba(220, 38, 38, 0.1);
      color: #dc2626;
      border: 1px solid rgba(220, 38, 38, 0.2);
    }
    .status-complete {
      background: rgba(34, 197, 94, 0.1);
      color: #22c55e;
      border: 1px solid rgba(34, 197, 94, 0.15);
    }
    .status-pending {
      background: rgba(245, 158, 11, 0.08);
      color: #f59e0b;
      border: 1px solid rgba(245, 158, 11, 0.12);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header-row {
        flex-direction: column;
        align-items: flex-start;
      }
      .datetime-inline {
        font-size: 14px;
      }
      .stat {
        min-width: 120px;
      }
      
      /* Perbaikan tampilan tabel pada mobile */
      .table-container {
        overflow-x: auto;
      }
      .table-container table {
        min-width: 600px;
      }
    }

    /* Table borders */
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #e2e8f0;
      padding: 0.75rem;
    }

    /* Modal improvements */
    .modal-box {
      padding: 1.5rem;
      border-radius: 0.5rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }
    .modal-box h3 {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 1.5rem;
    }
    .form-control {
      margin-bottom: 1rem;
    }
    .label {
      font-weight: 600;
      margin-bottom: 0.5rem;
      display: block;
    }

    /* Mobile progress container */
    @media (max-width: 767px) {
      .progress-container {
        background-color: #f8fafc;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      }
    }
    
    /* Empty state styling */
    .empty-state {
      text-align: center;
      padding: 2rem;
      color: #6b7280;
    }
    
    .empty-state i {
      font-size: 3rem;
      margin-bottom: 1rem;
      display: block;
    }
    
    /* Footer styling - Diperbarui sesuai README */
    .footer {
      background-color: #f8fafc;
      padding: 2rem 0;
      margin-top: 3rem;
      border-top: 1px solid #e2e8f0;
      width: 100%;
    }
    
    .footer-container {
      display: flex;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }
    
    .footer-banner {
      width: 75%;
      padding-right: 2rem;
    }
    
    .footer-banner img {
      width: 100%;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .footer-social {
      width: 25%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .footer-social a {
      display: block;
      margin-bottom: 1.5rem;
      text-align: center;
      text-decoration: none;
      color: #4b5563;
      transition: transform 0.3s;
    }
    
    .footer-social a:hover {
      transform: translateY(-3px);
      color: #4f46e5;
    }
    
    .footer-social img {
      width: 140px;
      height: auto;
      margin-bottom: 0.5rem;
      border-radius: 8px;
      transition: transform 0.3s;
    }
    
    .footer-social a:hover img {
      transform: scale(1.05);
    }
    
    .footer-text {
      text-align: center;
      color: #6b7280;
      font-size: 1rem;
      margin-top: 2rem;
      width: 100%;
      padding: 0 1rem;
    }
    
    /* Responsive footer */
    @media (max-width: 968px) {
      .footer-container {
        flex-direction: column;
      }
      
      .footer-banner, .footer-social {
        width: 100%;
      }
      
      .footer-banner {
        padding-right: 0;
        margin-bottom: 2rem;
      }
      
      .footer-social {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
        gap: 1rem;
      }
      
      .footer-social a {
        margin-bottom: 1rem;
        flex: 0 0 calc(33.333% - 1rem);
      }
      
      .footer-social img {
        width: 100px;
      }
    }
    
    @media (max-width: 640px) {
      .footer-social a {
        flex: 0 0 calc(50% - 1rem);
      }
      
      .footer-social img {
        width: 80px;
      }
    }
    
    /* Zebra striping untuk tabel */
    .table-zebra tbody tr:nth-child(even) {
      background-color: #f9fafb;
    }
    
    .table-zebra tbody tr:hover {
      background-color: #f3f4f6;
    }
  </style>
</head>
<body>
  <div class="container mx-auto p-4">
    <header class="mb-4">
      <!-- Header -->
      <div
        class="header-row flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2"
      >
        <div class="site-title flex items-center gap-2">
          <img
            src="public/logo.png"
            alt="DailyDo icon"
            class="w-8 h-8 sm:w-10 sm:h-10"
          />
          <h1 class="text-2xl sm:text-3xl font-extrabold">DailyDo</h1>
        </div>
        <div
          class="datetime-inline text-sm sm:text-base"
          id="datetime-display"
        >
          Jumat, 19 September 2025 | 23:23:46 WIB
        </div>
      </div>

      <!-- Progress Section -->
      <div class="progress-container mt-4 w-full">
        <!-- Desktop layout -->
        <div
          class="hidden md:flex stats stats-horizontal shadow w-full mb-4"
        >
          <div class="stat">
            <div class="flex items-center gap-2 stat-title">
              <i class="bx bx-list-ul text-primary text-xl"></i>
              Total
            </div>
            <div class="stat-value text-primary total-counter">0</div>
          </div>

          <div class="stat">
            <div class="flex items-center gap-2 stat-title">
              <i class="bx bx-check-circle text-success text-xl"></i>
              Completed
            </div>
            <div class="stat-value text-success completed-counter">0</div>
          </div>

          <div class="stat">
            <div class="flex items-center gap-2 stat-title">
              <i class="bx bx-time-five text-warning text-xl"></i>
              Pending
            </div>
            <div class="stat-value text-warning pending-counter">0</div>
          </div>

          <div class="stat">
            <div class="flex items-center gap-2 stat-title">
              <i class="bx bx-error-circle text-error text-xl"></i>
              Overdue
            </div>
            <div class="stat-value text-error overdue-counter">0</div>
          </div>

          <div class="stat">
            <div class="flex items-center gap-2 stat-title">
              <i class="bx bx-line-chart text-info text-xl"></i>
              Progress
            </div>
            <div class="stat-value text-info percentage-display">0%</div>
          </div>
        </div>

        <!-- Mobile layout -->
        <div class="md:hidden flex flex-col gap-2 mb-4">
          <div class="flex justify-between gap-2">
            <div class="stat flex-1">
              <div class="flex items-center gap-1 stat-title">
                <i class="bx bx-list-ul text-primary text-base"></i>
                Total
              </div>
              <div class="stat-value text-primary total-counter-mobile">0</div>
            </div>

            <div class="stat flex-1">
              <div class="flex items-center gap-1 stat-title">
                <i class="bx bx-line-chart text-info text-base"></i>
                Progress
              </div>
              <div class="stat-value text-info percentage-display-mobile">0%</div>
            </div>
          </div>

          <div class="flex justify-between gap-2">
            <div class="stat flex-1">
              <div class="flex items-center gap-1 stat-title">
                <i class="bx bx-check-circle text-success text-base"></i>
                Completed
              </div>
              <div class="stat-value text-success completed-counter-mobile">0</div>
            </div>

            <div class="stat flex-1">
              <div class="flex items-center gap-1 stat-title">
                <i class="bx bx-time-five text-warning text-base"></i>
                Pending
              </div>
              <div class="stat-value text-warning pending-counter-mobile">0</div>
            </div>

            <div class="stat flex-1">
              <div class="flex items-center gap-1 stat-title">
                <i class="bx bx-error-circle text-error text-base"></i>
                Overdue
              </div>
              <div class="stat-value text-error overdue-counter-mobile">0</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Search + Filter -->
      <div class="search-filter-section mb-4 w-full">
        <div class="flex items-center gap-4 w-full">
          <!-- Search bar fleksibel -->
          <div class="flex-1">
            <div class="relative">
              <input
                type="text"
                placeholder="Search tasks... (Ctrl+F)"
                class="input input-bordered w-full pl-10 search-input"
                id="search-input"
              />
              <i
                class="bx bx-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"
              ></i>
            </div>
          </div>

          <!-- Filter -->
          <div class="dropdown flex-shrink-0">
            <label tabindex="0" class="btn btn-outline">
              <i class="bx bx-filter mr-2"></i> Filter
            </label>
            <ul
              tabindex="0"
              class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52"
            >
              <li><a data-filter="all">All Tasks</a></li>
              <li><a data-filter="pending">Pending</a></li>
              <li><data-filter="completed">Completed</a></li>
              <li><a data-filter="overdue">Overdue</a></li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Toolbar -->
      <div
        class="todos-filter flex items-center justify-between mb-4 flex-wrap gap-2"
      >
        <div class="flex gap-2">
          <div class="dropdown">
            <label tabindex="0" class="btn btn-ghost btn-sm">
              <i class="bx bx-sort mr-1"></i> Sort
            </label>
            <ul
              tabindex="0"
              class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52"
            >
              <li>
                <a data-sort="name">By Name</a>
              </li>
              <li>
                <a data-sort="dueDate">By Due Date</a>
              </li>
              <li>
                <a data-sort="status">By Status</a>
              </li>
            </ul>
          </div>
          <!-- Help -->
          <div class="dropdown">
            <label tabindex="0" class="btn btn-ghost btn-sm">
              <i class="bx bx-help-circle"></i>
            </label>
            <div
              tabindex="0"
              class="dropdown-content p-3 shadow bg-base-100 rounded-box w-64 text-xs sm:text-sm whitespace-pre-line"
            >
              <b>Keyboard Shortcuts</b>
              <pre class="mt-1">
Ctrl + N → Add new task
Ctrl + F → Search tasks
Ctrl + A → Show all tasks
Escape   → Cancel operation
Enter    → Add task from modal
              </pre>
            </div>
          </div>
        </div>
        <!-- Buttons -->
        <div class="flex items-center gap-2">
          <!-- PERUBAHAN: Mengubah label menjadi button -->
          <button class="btn btn-primary" id="open-add-modal-btn">
            <i class="bx bx-plus mr-2"></i> Add Task
          </button>
          <button class="btn btn-error" id="delete-all-btn">
            <i class="bx bx-trash mr-2"></i> Delete All
          </button>
        </div>
      </div>

      <!-- Table -->
      <div class="table-container">
        <table class="table table-zebra w-full">
          <thead>
            <tr>
              <th class="w-2/6">Task</th>
              <th class="w-2/6">Detail</th>
              <th class="w-1/6">Due Date</th>
              <th class="w-1/6">Status</th>
              <th class="w-1/6">Actions</th>
            </tr>
          </thead>
          <tbody class="todos-list-body"></tbody>
        </table>
      </div>
    </header>
  </div>

  <!-- Footer - Diperbarui sesuai README -->
  <footer class="footer">
    <div class="footer-container">
      <div class="footer-banner">
        <img src="public/banner.gif" alt="Banner" />
      </div>
      <div class="footer-social">
        <a href="https://nursila-portfolio.vercel.app/">
          <img src="public/website.png" alt="Website" />
          Website
        </a>
        <a href="https://linkedin.com/in/nursilayusmitha">
          <img src="public/linkedin.png" alt="LinkedIn" />
          LinkedIn
        </a>
        <a href="https://instagram.com/nursilayusmitha">
          <img src="public/instagram.png" alt="Instagram" />
          Instagram
        </a>
        <a href="https://youtube.com/@aelara_id">
          <img src="public/youtube.png" alt="YouTube" />
          YouTube
        </a>
        <a href="mailto:nursilayusmitha@gmail.com">
          <img src="public/email.png" alt="Email" />
          Email
        </a>
      </div>
    </div>
  </footer>
    <p class="footer-text">
      ⭐ This project is an assignment for Coding Camp RevoU! ⭐ <br />
      If you find this project useful, please give it a star on <a href="https://github.com/nursilayusmitha/CodingCamp-150925-NursilaYusmitha" target="_blank">GitHub</a>!
    </p>
    <br />

  <!-- Task Modal -->
  <input type="checkbox" id="task-modal-toggle" class="modal-toggle" />
  <div class="modal modal-middle">
    <div class="modal-box relative">
      <h3 class="text-lg font-bold mb-4" id="task-modal-title">Add New Task</h3>

      <!-- Task Name -->
      <div class="form-control mb-3">
        <label class="label">Task Name</label>
        <input
          type="text"
          id="task-name"
          placeholder="Enter task name"
          class="input input-bordered"
        />
      </div>

      <!-- Task Detail -->
      <div class="form-control mb-3">
        <label class="label">Detail</label>
        <textarea
          id="task-detail"
          class="textarea textarea-bordered"
          placeholder="Enter detail"
        ></textarea>
      </div>

      <!-- Due Date & Time -->
      <div class="grid grid-cols-2 gap-2 mb-3">
        <div class="form-control">
          <label class="label">Due Date</label>
          <input type="date" id="task-due-date" class="input input-bordered" />
        </div>
        <div class="form-control">
          <label class="label">Due Time</label>
          <input type="time" id="task-due-time" class="input input-bordered" />
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="modal-action">
        <label for="task-modal-toggle" class="btn btn-ghost">Cancel</label>
        <button class="btn btn-primary" id="save-task-btn">Save</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <input type="checkbox" id="delete-confirm-modal" class="modal-toggle" />
  <div class="modal modal-middle">
    <div class="modal-box relative">
      <h3 class="text-lg font-bold mb-4">Confirm Delete</h3>
      <p id="delete-message">Are you sure you want to delete this task?</p>
      
      <div class="modal-action">
        <label for="delete-confirm-modal" class="btn btn-ghost">Cancel</label>
        <button class="btn btn-error" id="confirm-delete-btn">Delete</button>
      </div>
    </div>
  </div>

  <!-- Success Modal -->
  <input type="checkbox" id="success-modal" class="modal-toggle" />
  <div class="modal modal-middle">
    <div class="modal-box relative">
      <h3 class="text-lg font-bold mb-4">Success</h3>
      <p id="success-message">Operation completed successfully.</p>
      
      <div class="modal-action">
        <label for="success-modal" class="btn btn-primary">OK</label>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // Helpers
      function pad(n) {
        return n.toString().padStart(2, "0");
      }

      // Returns Jakarta Date object
      function nowJakarta() {
        return new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Jakarta" }));
      }

      function formatDateTimeJakarta(dateObj) {
        const dayName = dateObj.toLocaleDateString("id-ID", { weekday: "long" });
        const dateStr = dateObj.toLocaleDateString("id-ID", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });
        const timeStr =
          pad(dateObj.getHours()) +
          ":" +
          pad(dateObj.getMinutes()) +
          ":" +
          pad(dateObj.getSeconds()) +
          " WIB";
        return `${dayName}, ${dateStr} | ${timeStr}`;
      }

      // DOM refs for clock
      const datetimeDisplay = document.getElementById("datetime-display");

      function updateClock() {
        const jk = nowJakarta();
        datetimeDisplay.textContent = formatDateTimeJakarta(jk);
      }
      updateClock();
      setInterval(updateClock, 1000);

      // Storage
      const STORAGE_KEY = "dailydo_tasks_v1";
      let tasks = [];

      function loadTasks() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          tasks = raw ? JSON.parse(raw) : [];
        } catch (e) {
          tasks = [];
        }
      }

      function saveTasks() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
        updateProgressStats();
        renderTasks();
      }

      // DOM elements
      const todosBody = document.querySelector(".todos-list-body");
      const totalCounter = document.querySelector(".total-counter");
      const completedCounter = document.querySelector(".completed-counter");
      const pendingCounter = document.querySelector(".pending-counter");
      const overdueCounter = document.querySelector(".overdue-counter");
      const percentageDisplay = document.querySelector(".percentage-display");
      
      // Mobile counter elements
      const totalCounterMobile = document.querySelector(".total-counter-mobile");
      const completedCounterMobile = document.querySelector(".completed-counter-mobile");
      const pendingCounterMobile = document.querySelector(".pending-counter-mobile");
      const overdueCounterMobile = document.querySelector(".overdue-counter-mobile");
      const percentageDisplayMobile = document.querySelector(".percentage-display-mobile");

      // Modal elements
      const taskModalToggle = document.getElementById("task-modal-toggle");
      const openAddModalBtn = document.getElementById("open-add-modal-btn");
      const saveTaskBtn = document.getElementById("save-task-btn");

      const taskNameInput = document.getElementById("task-name");
      const taskDetailInput = document.getElementById("task-detail");
      const taskDueDateInput = document.getElementById("task-due-date");
      const taskDueTimeInput = document.getElementById("task-due-time");
      const taskModalTitle = document.getElementById("task-modal-title");

      // Delete modal elements
      const deleteConfirmModal = document.getElementById("delete-confirm-modal");
      const deleteMessage = document.getElementById("delete-message");
      const confirmDeleteBtn = document.getElementById("confirm-delete-btn");
      
      // Success modal elements
      const successModal = document.getElementById("success-modal");
      const successMessage = document.getElementById("success-message");

      let editingTaskId = null;
      let currentFilter = "all";
      let currentSearchKeyword = "";
      let currentSort = "dueDate";
      let deleteType = null; // 'all' or 'single'
      let taskToDelete = null;

      // Search
      document.getElementById("search-input").addEventListener("input", function (e) {
        currentSearchKeyword = e.target.value.toLowerCase();
        renderTasks();
      });

      // Filter
      document.querySelectorAll("[data-filter]").forEach((el) => {
        el.addEventListener("click", () => {
          currentFilter = el.getAttribute("data-filter");
          renderTasks();
        });
      });

      // Sort
      document.querySelectorAll("[data-sort]").forEach((el) => {
        el.addEventListener("click", () => {
          currentSort = el.getAttribute("data-sort");
          renderTasks();
        });
      });

      function openModal(mode = "add", task = null) {
        if (mode === "add") {
          editingTaskId = null;
          taskModalTitle.textContent = "Add New Task";
          taskNameInput.value = "";
          taskDetailInput.value = "";
          
          // Set default due date to today and time to 23:59
          const today = new Date();
          taskDueDateInput.value = today.toISOString().split('T')[0];
          taskDueTimeInput.value = "23:59";
        } else if (mode === "edit" && task) {
          editingTaskId = task.id;
          taskModalTitle.textContent = "Edit Task";
          taskNameInput.value = task.name;
          taskDetailInput.value = task.detail || "";

          if (task.due) {
            const jk = new Date(new Date(task.due).toLocaleString("en-US", { timeZone: "Asia/Jakarta" }));
            taskDueDateInput.value = jk.toISOString().slice(0, 10);
            taskDueTimeInput.value = pad(jk.getHours()) + ":" + pad(jk.getMinutes());
          } else {
            taskDueDateInput.value = "";
            taskDueTimeInput.value = "";
          }
        }
        // PERUBAHAN: Menampilkan modal dengan mengatur checked state
        taskModalToggle.checked = true;
      }

      function closeModal() {
        taskModalToggle.checked = false;
      }

      openAddModalBtn.addEventListener("click", function () {
        openModal("add");
      });

      // Save task
      saveTaskBtn.addEventListener("click", function () {
        const name = taskNameInput.value.trim();
        const detail = taskDetailInput.value.trim();
        const date = taskDueDateInput.value;
        const time = taskDueTimeInput.value;

        if (!name) {
          alert("Nama task wajib diisi.");
          return;
        }

        let dueISO = null;
        if (date) {
          const t = time || "23:59";
          // Create date in local timezone but store as ISO string
          const localDate = new Date(`${date}T${t}`);
          dueISO = localDate.toISOString();
        }

        if (editingTaskId) {
          const idx = tasks.findIndex((t) => t.id === editingTaskId);
          if (idx !== -1) {
            tasks[idx].name = name;
            tasks[idx].detail = detail;
            tasks[idx].due = dueISO;
            if (tasks[idx].status !== "completed") tasks[idx].status = "pending";
          }
        } else {
          const id = "t_" + Date.now();
          tasks.push({
            id,
            name,
            detail,
            due: dueISO,
            status: "pending",
            createdAt: new Date().toISOString(),
          });
        }

        saveTasks();
        closeModal();
        
        // Show success message
        successMessage.textContent = "Task has been " + (editingTaskId ? "updated" : "added") + " successfully.";
        successModal.checked = true;
      });

      // Delete all
      document.getElementById("delete-all-btn").addEventListener("click", function () {
        if (tasks.length === 0) {
          successMessage.textContent = "No tasks to delete.";
          successModal.checked = true;
          return;
        }
        
        deleteType = "all";
        deleteMessage.textContent = "Are you sure you want to delete ALL tasks? This action cannot be undone.";
        deleteConfirmModal.checked = true;
      });

      // Confirm delete button handler
      confirmDeleteBtn.addEventListener("click", function() {
        if (deleteType === "all") {
          tasks = [];
          saveTasks();
          successMessage.textContent = "All tasks have been deleted successfully.";
        } else if (deleteType === "single" && taskToDelete) {
          tasks = tasks.filter((t) => t.id !== taskToDelete);
          saveTasks();
          successMessage.textContent = "Task has been deleted successfully.";
        }
        
        // Close delete modal and show success modal
        deleteConfirmModal.checked = false;
        successModal.checked = true;
        
        // Reset delete state
        deleteType = null;
        taskToDelete = null;
      });

      // Update progress stats
      function updateProgressStats() {
        const nowUtc = Date.now();
        
        let total = tasks.length;
        let completed = 0;
        let pending = 0;
        let overdueCount = 0;

        tasks.forEach((task)=>{
          let isOverdue = false;
          if (task.due && task.status !== "completed") {
            const dueUtc = new Date(task.due).getTime();
            if (nowUtc > dueUtc) isOverdue = true;
          }

          if (task.status === "completed") completed++;
          else if (isOverdue) overdueCount++;
          else pending++;
        });

        // Update desktop counters
        totalCounter.textContent = total;
        completedCounter.textContent = completed;
        pendingCounter.textContent = pending;
        overdueCounter.textContent = overdueCount;

        // Update mobile counters
        totalCounterMobile.textContent = total;
        completedCounterMobile.textContent = completed;
        pendingCounterMobile.textContent = pending;
        overdueCounterMobile.textContent = overdueCount;

        const percent = total === 0 ? 0 : Math.round((completed / total) * 100);
        percentageDisplay.textContent = percent + "%";
        percentageDisplayMobile.textContent = percent + "%";
      }

      // Helper functions for sorting
      function getDueDateStatusWeight(task) {
        if (task.status === 'completed') return 2;
        if (task._isOverdue) return 1;
        return 0;
      }

      function getStatusWeight(task) {
        if (task.status === 'completed') return 2;
        if (task._isOverdue) return 1;
        return 0;
      }

      // Render tasks
      function renderTasks() {
        const nowUtc = Date.now();

        // Apply filter and search
        let visibleTasks = tasks.filter((task) => {
          let isOverdue = false;
          if (task.due && task.status !== "completed") {
            const dueUtc = new Date(task.due).getTime();
            if (nowUtc > dueUtc) isOverdue = true;
          }
          task._isOverdue = isOverdue;

          // Apply filter
          if (currentFilter === "pending" && (task.status === "completed" || isOverdue)) return false;
          if (currentFilter === "completed" && task.status !== "completed") return false;
          if (currentFilter === "overdue" && !isOverdue) return false;

          // Apply search
          if (currentSearchKeyword && 
              !(task.name.toLowerCase().includes(currentSearchKeyword) || 
                (task.detail || "").toLowerCase().includes(currentSearchKeyword))) {
            return false;
          }

          return true;
        });

        // Apply sorting
        visibleTasks.sort((a, b) => {
          if (currentSort === "name") {
            return a.name.localeCompare(b.name);
          } else if (currentSort === "dueDate") {
            // Sort by due date with custom ordering: pending, completed, overdue
            const weightA = getDueDateStatusWeight(a);
            const weightB = getDueDateStatusWeight(b);
            
            if (weightA !== weightB) {
              return weightA - weightB;
            }
            
            // If same status, sort by due date
            if (!a.due && !b.due) return 0;
            if (!a.due) return 1;
            if (!b.due) return -1;
            return new Date(a.due) - new Date(b.due);
          } else if (currentSort === "status") {
            // Sort by status: pending, overdue, completed
            const weightA = getStatusWeight(a);
            const weightB = getStatusWeight(b);
            
            if (weightA !== weightB) {
              return weightA - weightB;
            }
            
            // If same status, sort by due date
            if (!a.due && !b.due) return 0;
            if (!a.due) return 1;
            if (!b.due) return -1;
            return new Date(a.due) - new Date(b.due);
          }
          return 0;
        });

        todosBody.innerHTML = "";
        
        // Show empty state if no tasks
        if (visibleTasks.length === 0) {
          const emptyRow = document.createElement("tr");
          emptyRow.innerHTML = `
            <td colspan="5" class="empty-state">
              <i class="bx bx-clipboard"></i>
              <h3 class="text-lg font-semibold">No tasks found</h3>
              <p>
                ${currentFilter !== "all" ? `No tasks with status "${currentFilter}"` : "No tasks available. Add a new task to get started!"}
              </p>
            </td>
          `;
          todosBody.appendChild(emptyRow);
          return;
        }

        visibleTasks.forEach((task) => {
          const tr = document.createElement("tr");

          // Task column
          const tdTask = document.createElement("td");
          const title = document.createElement("div");
          title.className = "font-semibold";
          title.textContent = task.name;
          tdTask.appendChild(title);

          // Detail column
          const tdDetail = document.createElement("td");
          tdDetail.textContent = task.detail || "-";

          // Due column
          const tdDue = document.createElement("td");
          tdDue.className = "due-date-cell";
          if (task.due) {
            const d = new Date(task.due);
            const dateStr = d.toLocaleDateString("id-ID", {
              timeZone: "Asia/Jakarta",
              year: "numeric",
              month: "long",
              day: "numeric",
            });
            const timeStr = d.toLocaleTimeString("id-ID", {
              timeZone: "Asia/Jakarta",
              hour: "2-digit",
              minute: "2-digit",
              hour12: false,
            });
            tdDue.innerHTML = `<div>${dateStr}</div><div class="text-sm text-gray-500">${timeStr}</div>`;
          } else {
            tdDue.textContent = "-";
          }

          // Status column
          const tdStatus = document.createElement("td");
          const statusSpan = document.createElement("span");
          statusSpan.className = "status-badge";
          if (task.status === "completed") {
            statusSpan.classList.add("status-complete");
            statusSpan.innerHTML = '<i class="bx bx-check-circle"></i> Completed';
          } else if (task._isOverdue) {
            statusSpan.classList.add("status-overdue");
            statusSpan.innerHTML = '<i class="bx bx-error-circle"></i> Overdue';
          } else {
            statusSpan.classList.add("status-pending");
            statusSpan.innerHTML = '<i class="bx bx-time"></i> Pending';
          }
          tdStatus.appendChild(statusSpan);

          // Actions column
          const tdActions = document.createElement("td");

          const editBtn = document.createElement("button");
          editBtn.className = "btn btn-sm btn-info mr-2";
          editBtn.innerHTML = '<i class="bx bx-edit"></i>';
          editBtn.addEventListener("click", function () {
            openModal("edit", task);
          });

          const finishBtn = document.createElement("button");
          finishBtn.className = "btn btn-sm btn-success mr-2";
          finishBtn.innerHTML = '<i class="bx bx-check"></i>';
          finishBtn.addEventListener("click", function () {
            const idx = tasks.findIndex((t) => t.id === task.id);
            if (idx !== -1) {
              tasks[idx].status = "completed";
              saveTasks();
              successMessage.textContent = "Task marked as completed.";
              successModal.checked = true;
            }
          });

          const deleteBtn = document.createElement("button");
          deleteBtn.className = "btn btn-sm btn-error";
          deleteBtn.innerHTML = '<i class="bx bx-trash"></i>';
          deleteBtn.addEventListener("click", function () {
            deleteType = "single";
            taskToDelete = task.id;
            deleteMessage.textContent = "Are you sure you want to delete this task?";
            deleteConfirmModal.checked = true;
          });

          tdActions.appendChild(editBtn);
          if (task.status !== "completed") {
            tdActions.appendChild(finishBtn);
          }
          tdActions.appendChild(deleteBtn);

          tr.appendChild(tdTask);
          tr.appendChild(tdDetail);
          tr.appendChild(tdDue);
          tr.appendChild(tdStatus);
          tr.appendChild(tdActions);

          todosBody.appendChild(tr);
        });
      }

      // Keyboard shortcuts
      document.addEventListener("keydown", function (e) {
        if (e.ctrlKey || e.metaKey) {
          switch (e.key) {
            case "n":
              e.preventDefault();
              openModal("add");
              break;
            case "f":
              e.preventDefault();
              document.getElementById("search-input").focus();
              break;
            case "a":
              e.preventDefault();
              currentFilter = "all";
              renderTasks();
              break;
          }
        } else if (e.key === "Escape") {
          closeModal();
        }
      });

      // Init
      loadTasks();
      updateProgressStats();
      renderTasks();
    })();
  </script>
</body>
</html>